<!doctype html>
<html>

<head>
    <!--Page Info-->
    <title>SGD</title>
    <!--css link-->
    <!-- link rel="stylesheet" href="https://manglekuo.com/i-v/styles.css?v=2" -->
    <!--css link-->
    <link rel="stylesheet"
          href="styles/skeleton.css">
    <link rel="stylesheet"
          href="styles/styleNOTFORIFRAME.css">
    <link rel="stylesheet"
          href="styles/modal.css">
    <!--Required JS resources--> <!--NB: better to have resources before the main body but still works even if they are not-->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src=script/numeric/src/numeric.js></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.15.0/math.min.js"></script>
    
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
</head>
<body>
        <div id="nothing" style="margin-top: -5%"></div>
        <div class="guide">
            Instructions
        </div>
        <div class="guideModal">
            <div class="guideTest"></div>
            <button class="backBtn">◀ Back</button> <button class="nextBtn">Next ▶</button>
            <div class="modalContent">
                <p id="modal_0"> 
                    Gradient Descent is a method of finding the minimum of a function.
                    This is extremely useful in machine learning and neural networks as we want to find the correct combination of weights to minimise the error at the output of the neural network.
                    We can treat the error function for a neural network with one hundred connections as a function with one hundred parameters:
                    \( 
                        f(x_1, x_2,..., x_{100})
                    \)
                    The goal is to find the combination of \(x_i\) that make the function as close to zero as possible.                    
                </p>
                <p id="modal_1" hidden>
                    This is a difficult process to imagine in \(100\) dimensions, so lets imagine we have a neural network that has only two connections.
                    We can then write the function we are trying to solve as \(f(x, y) = 0\) where \(x\) and \(y\) are the weights for the two connections.
                    Each connection is a data point in a function we are trying to minimise.
                </p>
                <p id="modal_2" hidden>
                    In three dimensions, we can view the error function as a plane and we are trying to find the \(x\) and \(y\) values of the planes minimum.
                <br><br>
                    There are three common types of gradient descent: Full Gradient Descent; Batch Gradient Descent; and Stochastic Gradient Descent.
                </p>
                <p id="modal_3" hidden>
                    In <b>Full Gradient Descent</b>, we find the error in every point and we take small steps proportional to the negative of the gradient:
                    \[
                        \mathbf{x_{i+1}}=\mathbf{x_i}-\gamma\nabla f(\mathbf{x_i})
                    \]
                    We tune how fast the function learns using the learning rate \(\gamma\).
                    Using this technique, we can find the local minumum of the function.
                    <br><br>
                    In the context of our three dimensional function, we find the error with our current choice of \(x\) and \(y\) and then we update both of them in accordance to full gradient descent.
                </p>
                <p id="modal_4" hidden>
                    In <b>Batch Gradient Descent</b>, we split the dataset into batches of data points. 
                    We then carry out full gradient descent on each batch, shuffling the data points each time.
                    \[
                        \mathbf{x'_{i+1}}=\mathbf{x'_i}-\gamma\nabla f(\mathbf{x'_i})
                        \quad \text{where} \quad
                        \mathbf{x'} \subseteq \mathbf{x}
                    \]
                    This is often repeated multiple times.
                    Batch Gradient Descent can be useful if the data set is extremely large as we don't have to process all of the data.
                <br><br>
                    In the context of our three dimensional function, this is like if we found and reduced the error in the \(x\) values and \(y\) values separately.
                    Batch gradient descent doesn't make much sense in this context since we only have two possible data points.
                </p>
                <p id="modal_5" hidden>
                    In <b>Stochastic Gradient Descent</b>, we randomly pick one random data point and we only adjust that data point leaving the rest unmodified. 
                    We then repeat this many times until the error is small.
                    \[
                        \mathbf{x_{i+1}}=\mathbf{x_i}-\gamma\nabla f(x')
                        \quad \text{where} \quad
                        x' \in \mathbf{x}
                    \]
                    Stochastic gradient descent usually to converge faster (in terms of time) than full gradient descent since instead of updating hundreds of parameters, only one parameter needs to be updated.
                    The overall error in stochastic gradient descent tends to be greater than full gradient descent.
                    This can be due to the the function reaching the optimal value and then oscillating around it.
                    <br><br>
                    In the context of our three dimensional function, we choose randomly wether to update either \(x\) or \(y\) and then update accordingly.
                </p>
                <p id="modal_6" hidden>
                    When carrying out a gradient descent method, the choice of the <b>Learning Rate</b> \(\gamma\) needs to be chosen carefully. 
                    <br><br>
                    Choosing a value that is too high can cause the minimum of the function to be overshot and the function won't be able to converge.
                    Choosing a value that is too low will take a long time to converge.
                    <br><br>
                    Variable learing rates can be use that will modify the learning rate under different conditions, for example if the error plateaus, this may be because the function is scollating around the mimimum but since the learning rate is too high, it can get closer.
                    In that case, the learning rate can be lowered.
                </p>
                <p id="modal_7" hidden>
                    Due to the choice of learning rate and/or starting location, the gradient can increase so much that it has causes an overflow error in the maths.
                    This is known as <b>Gradient Explosion</b>.
                    <br><br>
                    Ways to counter this include capping the maximum size the new x and y can be, or by decreasing the learning rate.
                </p>
                <p id="modal_8" hidden>
                    You can see how different parameters by modifying the parameters.
                </p>
                <p id="modal_9" hidden>
                    You can apply a varying learning rate and clipping if you start to experience gradient explosion.
                </p>
                <p id="modal_10" hidden>
                    You can view the final vectors.
                    <br><br>
                    These each have their uses but not every one will be useful in all situations. 
                    The average vector is useful if the gradient descent method oscillates around a minima.
                    The best vector is useful if the final vector is not the most optimal solution. 
                    This might happen if the learning rate is too high.
                </p>
                <p id="modal_11" hidden>
                    You can view the process of finding the minima on the surface plot here.
                    <br><br>
                    Along with this you can view a graph of the error in the error graph tab.
                </p>
            </div>
        </div>
    <div class="container">
        <div class="row">
            <div class="six columns">
                <div id="title">
                    <h3>
                        Gradient Descent
                    </h3>
                    <p>
                        Modify the parameters to see how they affect the gradient descent.
                    </p>
                </div>
                <div id="params">
                    <div class="input" id="datadropdownstuff">
                        <label>f(x, y) =
                            <select id="datadropdown" onchange="initEverything(value)">
                                <option value='1.25*(i + 6)**2 + (j - 8)**2' selected>1.25(x+6)^2+(y-8)^2</option>
                                <option value='(1 - i)**2+100*(j - i**2)**2'>(1 - x)^2+100*(y - x^2)^2</option>
                                <option value='Math.sin(10*(i**2+j**2))/10 + 0.1'>sin(10*(x^2+y^2))/10</option>sin(5x)*cos(5y)/5
                                <option value='Math.sin(5*i)*Math.cos(5*j)/5 + 0.2'>sin(5x)*cos(5y)/5</option>
                            </select>
                        </label>
                    </div>
                    <div class="input" id="sliderStuff">
                        <label class="sliderTitle" style="font-size: x-large">Learning Rate:&nbsp;<!--rho-->
                            <span id="LRInputSlider" data-unit="">0.05</span>&nbsp; <!--default: 0-->
                        </label>
                        <div>
                            <label class="slider">
                                <span class="sliderMin">5e-7</span>
                                <input id="LRInput" class="inputs" type="range" value="10" min="0" max="19" step="1"/>
                                <span class="sliderMax">1.7</span>
                            </label>
                        </div>
                    </div>
                    <div id="info">
                        <div class="input">
                            <label id = "XInput" value = "100">Starting X = 100</label>
                        </div>
                        <div class="input">
                            <label id = "YInput" value = "100">Starting Y = 100</label>
                        </div>
                        <div class="input">
                            <label>Number of Iterations =
                                <input id = "interationsInput" type="text" value = "60">
                                <p id= "interationsInputError" style="color:#ff0000" hidden></p>
                            </label>
                        </div>
                    </div>

                    <div id="gdTypeStuff">
                        <label class="GDType">Gradient Descent Type:</label>
                        <select id="type" onchange="updateVals()">
                            <option value="basic" selected>Full</option>
                            <option value="batch" >Batch</option>
                            <option value="stochastic" >Stochastic</option>
                        </select>
                    </div>
                </div>
                <div id= "checkboxes" >
                    <input id="clipping" type="checkbox" style="float: left; margin-top: 5px;" value="off"><span for="checkbox"></span>
                    <div style="margin-left: 25px;">
                            Clip maximum values
                    </div>
                    <br>
                    <input id="learningRateDecrease" type="checkbox" style="float: left; margin-top: 5px;" value="off"><span for="checkbox"></span>
                    <div style="margin-left: 25px;">
                            Vary Learning Rate
                    </div>
                </div>
                <br>
                <div align="center" id="simButtons">
                    <div class="button" id="runGD" onclick="updatePlot()" >Run Simulation</div>
                    <div class="button" id="reset" onclick="reset()" >Reset</div>
                </div>

                <div class="row" id="vectors">
                    <div style="float: left; margin-top: 5px; margin-left: 50px;">
                        Average Vector:
                        <div id="averageVector" style="margin-left: 10px;">
                            \[
                                \left(\begin{matrix}
                                0 \\
                                0 \\
                                0
                                \end{matrix}\right)
                            \]
                        </div>
                    </div>
                    <div style="float: left; margin-top: 5px; margin-left: 100px;">
                        Best Vector:
                        <div id="bestVector" style="margin-left: 10px;">
                            \[
                                \left(\begin{matrix}
                                0 \\
                                0 \\
                                0
                                \end{matrix}\right)
                            \]
                        </div>
                    </div>
                    <div style="float: left; margin-top: 5px; margin-left: 100px;">
                        Final Vector:
                        <div id="finalVector" style="margin-left: 10px;">
                            \[
                                \left(\begin{matrix}
                                0 \\
                                0 \\
                                0
                                \end{matrix}\right)
                            \]
                        </div>
                    </div>
                </div>
            </div>
            <div class="six columns" id="tabs">
                    <ul class="tab-nav">
                        <li><a class="button active" href="#BoxViolin">Function</a></li>
                        <li><a id="data" class="button" href="#dataset">Error Graph</a></li>
                    </ul>
    
                    <div class="tab-content">
                        <div class="tab-pane active" id="BoxViolin" align="right">
                            <div id="graph" ></div>
                        </div>
                        <div class="tab-pane" id="dataset" align="right">
                            <div id="graph1" ></div> 
                        </div>
                    </div>
                </div>
    </div>

    <!--THE BRAINS-->
    <script src=script/modal.js></script>
    <script src=script/objects.js></script>
    <script src=script/SGD.js></script>
</body>

</html>
